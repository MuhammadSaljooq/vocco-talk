import{j as e}from"./index-DPr9HexU.js";import{r as a}from"./react-vendor-BWEkWSVM.js";import{T as v,G as _,M as G}from"./google-vendor-CvX4IAyf.js";import{d as Y,a as K,c as F}from"./audioUtils-BoSSlOMf.js";const s={DISCONNECTED:"DISCONNECTED",CONNECTING:"CONNECTING",CONNECTED:"CONNECTED",ERROR:"ERROR"},q=`You are Sobia, a high-end, extremely professional and warm virtual hospitality agent for Domino's Pakistan. 
Your primary goal is to provide a seamless, fluent, and delightful ordering experience in both English and Urdu.

--- URDU FLUENCY & STYLE (URDU TEHZEEB) ---
1. NATIVE PROSODY: Do not sound like a translator. Speak like a native Urdu speaker from Karachi or Lahore. Use proper Urdu intonation.
2. POLITE TERMINOLOGY: Use "Aap" always. Incorporate polite expressions like "Ji bilkul," "Zaroor Janab," "Beshak Sahiba," and "Zarray nawazi."
3. NATURAL FLOW: Avoid robotic "Step-by-step" lists unless asked. Instead, weave the menu into a conversation. 
   Example: "Hamara Chicken Tikka bohat pasand kiya jata hai, kya aap wo try karna chahen gay?"
4. NO HINDI: Use pure Urdu words for conversation (e.g., "Shukriya" instead of "Dhanyawad").

--- PERSONALITY ---
1. LOVELY & ENGAGING: You are not just a bot; you are a food enthusiast. When a customer picks a pizza, show genuine excitement. "Mmm, Behari Kabab! Yeh hamari sab se behtreen spicy choice hai."
2. CALM & PATIENT: If the customer is undecided, offer suggestions gracefully. "Koi jaldi nahi hai, aap itminan se menu dekh lein."

--- DOMINO'S PAKISTAN MENU KNOWLEDGE ---
- PIZZAS: Chicken Tikka, Chicken Fajita, Fajita Siciliano, Behari Kabab, Tex-Mex, Double Melt, Legend Ranch, Legend BBQ.
- SIZES: Personal (6"), Medium (9"), Large (12").
- CRUSTS: Hand Tossed, Italian Thin, Pan, Stuffed Crust.
- SIDES/DESSERTS: Chicken Kickers, Stuffed Cheesy Bread, Choco Lava Cake.
- DRINKS: Pepsi, 7Up, Aquafina.

Remember: You are the voice of Domino's Pakistan. Be fluent, be warm, and be professional.`;function Z(){const[N,c]=a.useState(s.DISCONNECTED),[A,E]=a.useState([]),[R,M]=a.useState(!1),[w,L]=a.useState([]),l=a.useRef(null),u=a.useRef(null),h=a.useRef(null),m=a.useRef(0),x=a.useRef(new Set),y=a.useRef(null),b=a.useRef(!1),U={name:"add_to_cart",parameters:{type:v.OBJECT,description:"Add an item to the user's shopping cart.",properties:{item_name:{type:v.STRING,description:"The name of the food item"},price:{type:v.NUMBER,description:"The estimated price in PKR"},quantity:{type:v.NUMBER,description:"The number of items"}},required:["item_name","price","quantity"]}},k=a.useCallback(async()=>{if(h.current){try{await h.current.close()}catch(t){console.warn("Error closing session:",t)}h.current=null}if(y.current&&(y.current.getTracks().forEach(t=>t.stop()),y.current=null),l.current&&l.current.state!=="closed"){try{await l.current.close().catch(console.warn)}catch(t){console.warn("Error closing audio context:",t)}l.current=null}if(u.current&&u.current.state!=="closed"){try{await u.current.close().catch(console.warn)}catch(t){console.warn("Error closing output audio context:",t)}u.current=null}x.current.forEach(t=>{try{t.stop()}catch{}}),x.current.clear(),c(s.DISCONNECTED),E([]),b.current=!1},[]),P=async()=>{try{c(s.CONNECTING);const t="";if(!t){alert("Please set VITE_GEMINI_API_KEY in your .env file"),c(s.ERROR);return}const p=new _({apiKey:t});l.current=new(window.AudioContext||window.webkitAudioContext)({sampleRate:16e3}),u.current=new(window.AudioContext||window.webkitAudioContext)({sampleRate:24e3});const S=await navigator.mediaDevices.getUserMedia({audio:!0});y.current=S;const T=p.live.connect({model:"gemini-2.5-flash-native-audio-preview-09-2025",callbacks:{onopen:async()=>{c(s.CONNECTED);try{const d=await T;h.current=d}catch(d){console.error("Failed to resolve session:",d),c(s.ERROR);return}const n=l.current.createMediaStreamSource(S),f=l.current.createScriptProcessor(4096,1,1);f.onaudioprocess=d=>{if(b.current)return;const g=d.inputBuffer.getChannelData(0),j=F(g);if(h.current)try{h.current.sendRealtimeInput({media:j})}catch(C){console.error("Failed to send audio input:",C)}},n.connect(f),f.connect(l.current.destination)},onmessage:async n=>{var d,g,j,C,D,I,O;const f=(C=(j=(g=(d=n.serverContent)==null?void 0:d.modelTurn)==null?void 0:g.parts[0])==null?void 0:j.inlineData)==null?void 0:C.data;if(f&&u.current)try{const r=u.current;m.current=Math.max(m.current,r.currentTime);const o=await Y(K(f),r,24e3,1),i=r.createBufferSource();i.buffer=o,i.connect(r.destination),i.onended=()=>x.current.delete(i),x.current.add(i),i.start(m.current),m.current+=o.duration}catch(r){console.error("Error processing audio output:",r)}if((D=n.serverContent)!=null&&D.interrupted&&(x.current.forEach(r=>{try{r.stop()}catch{}}),x.current.clear(),m.current=0),(I=n.serverContent)!=null&&I.outputTranscription){const r=n.serverContent.outputTranscription.text;E(o=>[...o,`Sobia: ${r}`].slice(-5))}else if((O=n.serverContent)!=null&&O.inputTranscription){const r=n.serverContent.inputTranscription.text;E(o=>[...o,`You: ${r}`].slice(-5))}if(n.toolCall){for(const r of n.toolCall.functionCalls)if(r.name==="add_to_cart"){const o=r.args;L(i=>[...i,{id:Math.random().toString(36).substr(2,9),name:o.item_name,price:o.price,quantity:o.quantity}]),T.then(i=>i.sendToolResponse({functionResponses:{id:r.id,name:r.name,response:{result:"Ji Janab, add kar diya hai."}}}))}}},onerror:n=>{c(s.ERROR)},onclose:()=>{c(s.DISCONNECTED)}},config:{responseModalities:[G.AUDIO],systemInstruction:q,tools:[{functionDeclarations:[U]}],outputAudioTranscription:{},inputAudioTranscription:{},speechConfig:{voiceConfig:{prebuiltVoiceConfig:{voiceName:"Kore"}}}}});h.current=await T}catch(t){console.error("Failed to start session:",t),c(s.ERROR)}};a.useEffect(()=>()=>k(),[k]);const B=w.reduce((t,p)=>t+p.price*p.quantity,0);return e.jsxs("div",{className:"w-full max-w-4xl mx-auto bg-surface-card rounded-2xl shadow-xl overflow-hidden border border-white/5",children:[e.jsxs("div",{className:"bg-gradient-to-r from-accent/20 to-accent/10 p-4 flex items-center justify-between border-b border-white/5",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-accent/20 rounded-md flex items-center justify-center p-1 border border-accent/30",children:e.jsx("div",{className:"w-full h-full bg-accent rounded"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-white",children:"Domino's Pakistan"}),e.jsx("p",{className:"text-xs text-secondary-grey",children:"Sobia - Voice Ordering Assistant"})]})]}),N===s.CONNECTED&&e.jsxs("span",{className:"flex h-2 w-2 relative",children:[e.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-accent opacity-75"}),e.jsx("span",{className:"relative inline-flex rounded-full h-2 w-2 bg-accent"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 p-4",children:[e.jsx("div",{className:"md:col-span-2 space-y-4",children:e.jsxs("div",{className:"bg-surface-dark rounded-xl p-6 min-h-[300px] flex flex-col items-center justify-center text-center space-y-6 border border-white/5",children:[N===s.DISCONNECTED&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-20 h-20 bg-accent/10 rounded-full flex items-center justify-center border border-accent/20",children:e.jsx("svg",{className:"w-10 h-10 text-accent",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5",d:"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"})})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-black text-white",children:"Assalam-o-Alaikum!"}),e.jsx("p",{className:"text-secondary-grey mt-2",children:"صوبیہ آپ کے آرڈر کے لیے تیار ہیں"})]}),e.jsx("button",{onClick:P,className:"bg-accent hover:bg-accent/80 text-white px-10 py-4 rounded-full font-black text-lg transition-all shadow-[0_0_20px_-5px_rgba(227,101,91,0.5)] hover:scale-105",children:"Start Ordering"})]}),N===s.CONNECTING&&e.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[e.jsx("div",{className:"w-16 h-16 border-4 border-accent/20 border-t-accent rounded-full animate-spin"}),e.jsx("p",{className:"text-secondary-grey font-bold italic",children:"Connecting you to Sobia..."})]}),N===s.CONNECTED&&e.jsxs("div",{className:"w-full space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4 text-accent justify-center",children:[e.jsxs("span",{className:"relative flex h-3 w-3",children:[e.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-primary opacity-75"}),e.jsx("span",{className:"relative inline-flex rounded-full h-3 w-3 bg-primary"})]}),e.jsx("span",{className:"font-black text-sm uppercase tracking-widest text-white",children:"On Call with Sobia"})]}),e.jsx("div",{className:"w-full bg-surface-card rounded-2xl p-5 border border-white/5 shadow-inner",children:e.jsx("div",{className:"space-y-3 max-h-[150px] overflow-y-auto",children:A.map((t,p)=>e.jsx("div",{className:`flex ${t.startsWith("Sobia:")?"justify-start":"justify-end"}`,children:e.jsx("div",{className:`max-w-[85%] rounded-2xl px-5 py-3 text-sm shadow-sm ${t.startsWith("Sobia:")?"bg-surface-dark text-white border border-white/5":"bg-accent text-white"}`,children:e.jsx("span",{dir:/[\u0600-\u06FF]/.test(t)?"rtl":"ltr",className:"block",children:t.split(":").slice(1).join(":").trim()})})},p))})}),e.jsxs("div",{className:"flex gap-6 justify-center",children:[e.jsx("button",{onClick:()=>{b.current=!b.current,M(b.current)},className:`p-5 rounded-full transition-all border ${R?"bg-accent/20 text-accent border-accent/30":"bg-white/5 text-white border-white/10 hover:bg-white/10"}`,children:e.jsx("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:R?e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"}):e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"})})}),e.jsx("button",{onClick:k,className:"bg-accent hover:bg-accent/80 text-white px-10 py-4 rounded-full font-black transition-all shadow-lg shadow-accent/20",children:"End Call"})]})]})]})}),e.jsxs("div",{className:"bg-surface-card rounded-xl shadow-sm border border-white/5 overflow-hidden",children:[e.jsx("div",{className:"p-4 bg-surface-dark border-b border-white/5",children:e.jsx("h2",{className:"text-lg font-bold text-white",children:"Current Order"})}),e.jsx("div",{className:"p-4 space-y-3 max-h-[200px] overflow-y-auto",children:w.length===0?e.jsx("p",{className:"text-secondary-grey text-sm italic text-center py-4",children:"No items yet"}):w.map(t=>e.jsxs("div",{className:"flex justify-between text-sm border-b border-white/5 pb-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-white",children:t.name}),e.jsxs("p",{className:"text-xs text-secondary-grey",children:["Qty: ",t.quantity]})]}),e.jsxs("p",{className:"font-medium text-accent",children:["Rs. ",t.price*t.quantity]})]},t.id))}),w.length>0&&e.jsx("div",{className:"p-4 bg-surface-dark border-t border-white/5",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-bold text-white",children:"Total"}),e.jsxs("span",{className:"text-xl font-black text-accent",children:["Rs. ",B]})]})})]})]})]})}export{Z as default};
