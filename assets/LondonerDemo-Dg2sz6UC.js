import{j as e}from"./index-DPr9HexU.js";import{r as s}from"./react-vendor-BWEkWSVM.js";import{T as n,G as Ge,M as Fe}from"./google-vendor-CvX4IAyf.js";import{d as Me,a as Ye,c as $e}from"./audioUtils-BoSSlOMf.js";const d={IDLE:"IDLE",CONNECTING:"CONNECTING",ACTIVE:"ACTIVE",ERROR:"ERROR"},Ve={beginner:{label:"Beginner",description:"Focus on basic vocabulary and simple sentences",icon:"ðŸŒ±"},intermediate:{label:"Intermediate",description:"Practice complex grammar and idioms",icon:"ðŸ“š"},advanced:{label:"Advanced",description:"Master native-level fluency and cultural nuances",icon:"ðŸŽ“"}},Ue={free:{label:"Free Conversation",description:"Natural conversation with gentle corrections",icon:"ðŸ’¬"},structured:{label:"Structured Learning",description:"Focused practice with detailed feedback",icon:"ðŸ“–"},pronunciation:{label:"Pronunciation Focus",description:"Intensive pronunciation practice",icon:"ðŸŽ¤"},tasks:{label:"Task Practice",description:"Structured speaking exercises and drills",icon:"ðŸŽ¯"}},je=(l,p)=>`You are "Alistair", a sophisticated, witty, and encouraging British English Tutor from London. 
Your primary goal is to help the user achieve native-like fluency in British English with a focus on Received Pronunciation (RP).

PERSONALITY:
- Refined Received Pronunciation (RP).
- Friendly, polite, and classically British (think a charming BBC presenter).
- Use British idioms naturally (e.g., "spot on", "bit of a muddle", "I'm chuffed").

DIFFICULTY LEVEL: ${l}
${l==="beginner"?"- Use simple vocabulary and short sentences. Be very patient and encouraging.":""}
${l==="intermediate"?"- Introduce more complex grammar and British idioms. Challenge the user appropriately.":""}
${l==="advanced"?"- Focus on subtle nuances, cultural subtext, and perfect RP pronunciation.":""}

LEARNING MODE: ${p}
${p==="structured"?"- Provide IMMEDIATE corrections after each user utterance. Use the provide_correction function for every mistake.":""}
${p==="pronunciation"?"- Focus intensely on pronunciation. Correct every phonetic error immediately using provide_correction.":""}
${p==="free"?"- Provide gentle, natural corrections only when significant errors occur.":""}
${p==="tasks"?`- You are in TASK PRACTICE mode. Generate speaking tasks using the generate_speaking_task function. Task types: roleplay (real-world conversation scenarios), pronunciation (RP sound practice), grammar (grammar exercises), idiom (British idioms). FOR ROLEPLAY TASKS: You MUST provide a complete dialogue script showing what the user should say. Include: 1. scenario: Clear description of the situation (e.g., "You are at a London pub ordering a drink"), 2. dialogue_script: A complete conversation script with both sides shown. Format it clearly showing the other person's lines (e.g., "Barman: What can I get you?") and the user's lines they should practice (e.g., "You: I'd like a pint of lager, please") with context and natural flow, 3. user_lines: Array of the specific phrases/lines the user needs to say, 4. instructions: Should reference the script and tell them to follow it. The dialogue script should be a proper British English conversation that the user can practice. Make it realistic and culturally appropriate. After generating a task, wait for the user to speak their response. IMMEDIATELY after the user finishes speaking, use evaluate_task_response to evaluate their answer. Then provide encouraging feedback and automatically generate the next task. Always include the task_id from the current task when evaluating.`:""}

PHONETIC & ACCENT MONITORING:
Monitor the user for:
1. Vowel Sounds: Broad 'a' (bath-trap split) - /É‘Ë/ in 'bath', 'glass', 'dance'
2. Long 'u': /juË/ sound in 'duty', 'Tuesday' (not 'dooty')
3. Intonation: "High-Falling" stress pattern of polite British speech
4. Linking 'r': Smooth transitions between words ending in 'r' and starting with vowels
5. Plosives: Crisp 't' sounds (avoiding glottalisation in formal contexts)

PEDAGOGICAL INSTRUCTIONS:
- Actively monitor for:
  1. Grammatical errors (e.g., "I haven't saw" -> "I haven't seen")
  2. Americanisms (suggest "lift" instead of "elevator", "flat" instead of "apartment")
  3. Cultural nuances (understatement, "banter", politeness markers)
  4. Pronunciation errors (especially RP-specific sounds)

${p==="structured"||p==="pronunciation"?"- ALWAYS use the provide_correction function when you detect ANY error (grammar, vocabulary, pronunciation, or cultural).":"- Gently offer corrections after natural pauses, but don't interrupt the flow."}

- If in a Roleplay scenario, stay in character but maintain your tutor "ear".
- Be encouraging and positive. Frame corrections as learning opportunities.`,we=[{id:"pub",title:"The Local Pub",description:'Order a pint and chat about the "footie" at the Churchill Arms.',icon:"ðŸº",prompt:"Let's roleplay. You are a friendly barman at a cozy London pub. I've just walked in. Start by welcoming me and asking what I'd like to drink, using typical British pub etiquette."},{id:"interview",title:"Job Interview",description:"A formal interview for a marketing role in the City of London.",icon:"ðŸ’¼",prompt:"Let's roleplay. You are an HR manager at a prestigious British firm. You are interviewing me for a new role. Please be professional, use formal British English, and start the interview by introducing yourself."},{id:"weather",title:"Weather Small Talk",description:"Master the essential British skill of complaining about the grey skies.",icon:"ðŸŒ§ï¸",prompt:"Let's roleplay. We are standing at a bus stop in London. It's drizzling and rather miserable. Start a conversation by making typical British small talk about how dreadful the weather is today."},{id:"tea",title:"Afternoon Tea",description:"Discuss scones, jam-first vs cream-first, and tea types.",icon:"â˜•",prompt:"Let's roleplay. We are having afternoon tea at a fancy hotel in Mayfair. Start by asking me how I take my tea and suggest some of the delicacies on the tiered stand."},{id:"directions",title:"Lost on the Tube",description:"Practise asking for directions when the Northern Line is suspended.",icon:"ðŸš‡",prompt:"Let's roleplay. I am a confused tourist at King's Cross St. Pancras. You are a helpful Londoner. Notice I'm struggling with the Tube map and offer your assistance politely."},{id:"subtext",title:"The Politeness Paradox",description:"Learn to decode the hidden meanings behind British understatements.",icon:"ðŸ”",prompt:"Let's have a conversation where you teach me about British subtext. Present a common British understatement or 'polite' insult, and ask me what you are actually thinking. Correct my cultural understanding if I miss the mark."}];function tt(){var he;const[l,p]=s.useState(d.IDLE),[We,Y]=s.useState([]),[Je,ke]=s.useState([]),[$,V]=s.useState(""),[U,W]=s.useState(""),[z,P]=s.useState(null),[H,q]=s.useState(null),[Ke,Q]=s.useState(null),[D,X]=s.useState("practice"),[Z,ze]=s.useState(!1),[ee,Te]=s.useState([]),[He,J]=s.useState([]),[qe,te]=s.useState([]),[O,Se]=s.useState("intermediate"),[u,Ie]=s.useState("free"),[se,re]=s.useState([]),[c,I]=s.useState(null),[ae,Ce]=s.useState([]),[x,f]=s.useState(null),[ne,C]=s.useState(!1),T=s.useRef(null),R=s.useRef(null),_=s.useRef(0),S=s.useRef(new Set),ie=s.useRef(null),oe=s.useRef(null),A=s.useRef(!1),v=s.useRef(""),y=s.useRef(""),E=s.useRef([]),le=s.useRef(null),L=s.useRef(null),h=s.useRef(null),[j,ce]=s.useState(()=>{const t=localStorage.getItem("british_lexicon");return t?JSON.parse(t):[]}),[b,de]=s.useState(()=>{const t=localStorage.getItem("londoner_progress");return t?JSON.parse(t):{sessions:[],totalMinutes:0,streakDays:0,badges:[],paradoxScore:0,paradoxAttempts:0,correctionsReceived:0,mistakesFixed:0}});s.useEffect(()=>localStorage.setItem("british_lexicon",JSON.stringify(j)),[j]),s.useEffect(()=>localStorage.setItem("londoner_progress",JSON.stringify(b)),[b]);const ue={name:"provide_correction",parameters:{type:n.OBJECT,description:"Provide a correction when the user makes a mistake in grammar, vocabulary, pronunciation, or cultural understanding",properties:{error_type:{type:n.STRING,description:"Type of error: grammar, vocabulary, pronunciation, americanism, or cultural",enum:["grammar","vocabulary","pronunciation","americanism","cultural"]},original_text:{type:n.STRING,description:"The text the user said that contains the error"},corrected_text:{type:n.STRING,description:"The corrected version in proper British English"},explanation:{type:n.STRING,description:"A brief, encouraging explanation of the correction"},phonetic_guidance:{type:n.STRING,description:"Optional: Phonetic guidance for pronunciation errors (IPA notation)"}},required:["error_type","original_text","corrected_text","explanation"]}},Re={name:"generate_speaking_task",parameters:{type:n.OBJECT,description:"Generate a speaking task for the user to practice. Task types: roleplay, pronunciation, grammar, idiom",properties:{task_type:{type:n.STRING,description:"Type of task to generate",enum:["roleplay","pronunciation","grammar","idiom"]},instructions:{type:n.STRING,description:"Clear instructions for the user on what to do"},example_response:{type:n.STRING,description:"An example of a good response (for reference, not shown to user)"},focus_area:{type:n.STRING,description:'What this task focuses on (e.g., "past perfect tense", "RP /É‘Ë/ sound", "pub etiquette")'},difficulty_adjusted:{type:n.BOOLEAN,description:"Whether the task is appropriate for the current difficulty level"},scenario:{type:n.STRING,description:"For roleplay tasks: The situation/scenario description"},dialogue_script:{type:n.STRING,description:"For roleplay tasks: A complete dialogue script showing what the user should say. Format as a conversation with clear lines for the user to speak. Include context and the other person's lines too."},user_lines:{type:n.ARRAY,items:{type:n.STRING},description:"For roleplay tasks: Array of specific lines/phrases the user should say in the conversation"}},required:["task_type","instructions","focus_area"]}},_e={name:"evaluate_task_response",parameters:{type:n.OBJECT,description:"Evaluate the user's response to a speaking task",properties:{task_id:{type:n.STRING,description:"ID of the task being evaluated"},user_response:{type:n.STRING,description:"What the user said in response to the task"},is_correct:{type:n.BOOLEAN,description:"Whether the response was correct/appropriate"},score:{type:n.NUMBER,description:"Score out of 100 for the response"},feedback:{type:n.STRING,description:"Detailed feedback on the response"},strengths:{type:n.ARRAY,items:{type:n.STRING},description:"What the user did well"},improvements:{type:n.ARRAY,items:{type:n.STRING},description:"Areas for improvement"},should_retry:{type:n.BOOLEAN,description:"Whether the user should try this task again"}},required:["task_id","user_response","is_correct","score","feedback"]}},w=s.useCallback(async()=>{A.current&&(A.current=!1,[oe.current,ie.current,T.current,R.current].forEach(t=>{t instanceof MediaStream?t.getTracks().forEach(r=>r.stop()):t&&"close"in t?t.close():t&&"disconnect"in t&&t.disconnect()}),S.current.forEach(t=>{try{t.stop()}catch{}}),S.current.clear(),h.current&&(clearTimeout(h.current),h.current=null),p(d.IDLE),q(null),Q(null),le.current=null,v.current="",y.current="",V(""),W(""),J([]),I(null),f(null),C(!1))},[]),K=s.useCallback(async t=>{try{l!==d.IDLE&&await w(),p(d.CONNECTING),P(null),Te([]),ke([]),te([]),re([]),I(null),f(null),C(!1),E.current=[];const r=Date.now();Q(r),le.current=r,t&&q(t.id);const B="";if(!B){P("Please set VITE_GEMINI_API_KEY in your .env file"),p(d.ERROR);return}const De=new Ge({apiKey:B});T.current=new AudioContext({sampleRate:16e3}),R.current=new AudioContext({sampleRate:24e3}),await T.current.resume(),await R.current.resume();const ge=await navigator.mediaDevices.getUserMedia({audio:!0});ie.current=ge;const Oe=t?`${je(O,u)}

SCENARIO: ${t.title}. Context: ${t.description}`:je(O,u),G=De.live.connect({model:"gemini-2.5-flash-native-audio-preview-12-2025",config:{responseModalities:[Fe.AUDIO],speechConfig:{voiceConfig:{prebuiltVoiceConfig:{voiceName:"Puck"}}},systemInstruction:Oe,inputAudioTranscription:{},outputAudioTranscription:{},tools:u==="tasks"?[{functionDeclarations:[Re,_e,ue]}]:u==="structured"||u==="pronunciation"?[{functionDeclarations:[ue]}]:void 0},callbacks:{onopen:()=>{p(d.ACTIVE),A.current=!0;const g=T.current.createMediaStreamSource(ge),k=T.current.createScriptProcessor(4096,1,1);oe.current=k,k.onaudioprocess=N=>{if(A.current){const F=$e(N.inputBuffer.getChannelData(0));G.then(M=>M.sendRealtimeInput({media:F}))}},g.connect(k),k.connect(T.current.destination),u==="tasks"?G.then(N=>{N.sendRealtimeInput([{text:"Right, let's begin with some structured practice. I'll give you tasks to complete. Generate the first task now."}])}):t&&G.then(N=>{N.sendRealtimeInput([{text:t.prompt}])})},onmessage:async g=>{var N,F,M,be,fe,ye,Ne;if(!A.current)return;if(g.toolCall){const m=g.toolCall;if(m.name==="generate_speaking_task"){const i=m.args,o={id:Math.random().toString(36).substr(2,9),...i,timestamp:new Date,status:"active"};I(o),C(!0),f(null)}if(m.name==="evaluate_task_response"){const i=m.args;if(f(i),C(!1),c){const o={...c,status:"completed",evaluation:i,completedAt:new Date};Ce(a=>[o,...a]),de(a=>({...a,tasksCompleted:(a.tasksCompleted||0)+1,tasksScore:(a.tasksScore||0)+i.score,tasksTotalScore:((a.tasksTotalScore||0)+i.score)/((a.tasksCompleted||0)+1)}))}setTimeout(()=>{I(null),f(null)},5e3)}if(m.name==="provide_correction"){const i=m.args,o={id:Math.random().toString(36).substr(2,9),...i,timestamp:new Date};te(a=>[o,...a]),re(a=>[o,...a].slice(0,5)),de(a=>({...a,correctionsReceived:(a.correctionsReceived||0)+1}))}}const k=(F=(N=g.serverContent)==null?void 0:N.modelTurn)==null?void 0:F.parts;if(k&&R.current){for(const m of k)if((M=m.inlineData)!=null&&M.data){const i=R.current;_.current=Math.max(_.current,i.currentTime);const o=await Me(Ye(m.inlineData.data),i,24e3,1),a=i.createBufferSource();a.buffer=o,a.connect(i.destination),a.onended=()=>S.current.delete(a),a.start(_.current),_.current+=o.duration,S.current.add(a)}}if((be=g.serverContent)!=null&&be.interrupted&&(S.current.forEach(m=>{try{m.stop()}catch{}}),S.current.clear(),_.current=0),(fe=g.serverContent)!=null&&fe.inputTranscription){const m=g.serverContent.inputTranscription.text;v.current+=m,V(v.current),J(i=>{const o=i.filter(a=>a.speaker!=="user");return[{speaker:"user",text:v.current,id:Date.now()},...o]}),h.current&&clearTimeout(h.current),h.current=setTimeout(()=>{if(v.current.trim()){const i={id:Math.random().toString(36).substr(2,9),userText:v.current,modelText:"",timestamp:new Date};Y(o=>[i,...o]),E.current.push(i)}v.current="",V("")},500)}if((ye=g.serverContent)!=null&&ye.outputTranscription){const m=g.serverContent.outputTranscription.text;y.current+=m,W(y.current),J(i=>{const o=i.filter(a=>a.speaker!=="assistant");return[{speaker:"assistant",text:y.current,id:Date.now()},...o]}),h.current&&clearTimeout(h.current),h.current=setTimeout(()=>{if(y.current.trim()){const i=E.current[E.current.length-1];if(i)i.modelText=y.current,Y(o=>{const a=[...o],ve=a.findIndex(Be=>Be.id===i.id);return ve>=0&&(a[ve]={...i}),a});else{const o={id:Math.random().toString(36).substr(2,9),userText:"",modelText:y.current,timestamp:new Date};Y(a=>[o,...a]),E.current.push(o)}}y.current="",W("")},500)}(Ne=g.serverContent)!=null&&Ne.turnComplete&&h.current&&(clearTimeout(h.current),h.current=null)},onerror:g=>{P("Blimey! Network error."),w()},onclose:()=>w()}});L.current=await G}catch{P("Mic access denied."),p(d.ERROR),w()}},[l,w,O,u]),Ae=s.useCallback(()=>{l===d.ACTIVE?w():K()},[l,K,w]),Ee=t=>({grammar:"bg-blue-500/20 text-blue-400 border-blue-500/30",vocabulary:"bg-purple-500/20 text-purple-400 border-purple-500/30",pronunciation:"bg-orange-500/20 text-orange-400 border-orange-500/30",americanism:"bg-red-500/20 text-red-400 border-red-500/30",cultural:"bg-yellow-500/20 text-yellow-400 border-yellow-500/30"})[t]||"bg-gray-500/20 text-gray-400 border-gray-500/30",Le=t=>({grammar:"ðŸ“",vocabulary:"ðŸ“š",pronunciation:"ðŸŽ¤",americanism:"ðŸ‡ºðŸ‡¸",cultural:"â˜•"})[t]||"ðŸ’¡",me=t=>({roleplay:"ðŸŽ­",pronunciation:"ðŸŽ¤",grammar:"ðŸ“",idiom:"ðŸ’¬"})[t]||"ðŸŽ¯",pe=t=>({roleplay:"bg-purple-500/20 text-purple-400 border-purple-500/30",pronunciation:"bg-orange-500/20 text-orange-400 border-orange-500/30",grammar:"bg-blue-500/20 text-blue-400 border-blue-500/30",idiom:"bg-yellow-500/20 text-yellow-400 border-yellow-500/30"})[t]||"bg-gray-500/20 text-gray-400 border-gray-500/30",xe=()=>{L.current&&u==="tasks"&&(L.current.sendRealtimeInput([{text:"Generate the next task, please."}]),f(null))},Pe=()=>{L.current&&u==="tasks"&&(L.current.sendRealtimeInput([{text:"Skip this task and generate the next one."}]),f(null),I(null))};return e.jsxs("div",{className:"w-full max-w-6xl mx-auto px-4 py-8",children:[e.jsx("div",{className:"mb-8 flex gap-2 bg-surface-dark/50 p-1.5 rounded-2xl border border-white/5",children:[{id:"practice",label:"Practice",icon:"ðŸŽ¤"},{id:"lexicon",label:"Lexicon",icon:"ðŸ“š"},{id:"dashboard",label:"Dashboard",icon:"ðŸ“Š"}].map(t=>e.jsxs("button",{onClick:()=>X(t.id),className:`flex-1 px-4 py-3 rounded-xl text-sm font-bold transition-all flex items-center justify-center gap-2 ${D===t.id?"bg-primary text-white shadow-lg":"text-secondary-grey hover:text-white hover:bg-white/5"}`,children:[e.jsx("span",{children:t.icon}),e.jsx("span",{children:t.label})]},t.id))}),D==="practice"&&e.jsxs("div",{className:"space-y-6",children:[l===d.IDLE&&e.jsxs("div",{className:"bg-surface-card rounded-2xl p-6 border border-white/5",children:[e.jsxs("h3",{className:"text-lg font-bold text-white mb-4 flex items-center gap-2",children:[e.jsx("span",{className:"material-symbols-outlined text-primary",children:"settings"}),"Learning Settings"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-secondary-grey mb-3 uppercase tracking-widest",children:"Difficulty Level"}),e.jsx("div",{className:"flex gap-2",children:Object.entries(Ve).map(([t,r])=>e.jsxs("button",{onClick:()=>Se(t),className:`flex-1 p-3 rounded-xl border-2 transition-all ${O===t?"border-primary bg-primary/10 text-primary":"border-white/10 bg-surface-dark/50 text-secondary-grey hover:border-white/20"}`,children:[e.jsx("div",{className:"text-2xl mb-1",children:r.icon}),e.jsx("div",{className:"text-xs font-bold",children:r.label})]},t))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-secondary-grey mb-3 uppercase tracking-widest",children:"Learning Mode"}),e.jsx("div",{className:"flex gap-2",children:Object.entries(Ue).map(([t,r])=>e.jsxs("button",{onClick:()=>Ie(t),className:`flex-1 p-3 rounded-xl border-2 transition-all ${u===t?"border-primary bg-primary/10 text-primary":"border-white/10 bg-surface-dark/50 text-secondary-grey hover:border-white/20"}`,children:[e.jsx("div",{className:"text-2xl mb-1",children:r.icon}),e.jsx("div",{className:"text-xs font-bold",children:r.label})]},t))})]})]}),(u==="structured"||u==="pronunciation")&&e.jsx("div",{className:"mt-4 p-4 bg-primary/10 border border-primary/20 rounded-xl",children:e.jsxs("p",{className:"text-sm text-primary font-medium",children:[e.jsx("span",{className:"material-symbols-outlined align-middle mr-2",children:"info"}),u==="structured"?"Structured mode provides immediate corrections for all mistakes.":"Pronunciation mode focuses intensively on accent and phonetics."]})}),u==="tasks"&&e.jsx("div",{className:"mt-4 p-4 bg-primary/10 border border-primary/20 rounded-xl",children:e.jsxs("p",{className:"text-sm text-primary font-medium",children:[e.jsx("span",{className:"material-symbols-outlined align-middle mr-2",children:"info"}),"Task Practice mode provides structured speaking exercises. Complete each task by speaking your response."]})})]}),c&&u==="tasks"&&e.jsxs("div",{className:"bg-surface-card rounded-2xl p-6 border border-white/5 shadow-xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-bold text-white flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:me(c.task_type)}),"Current Task"]}),e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold border ${pe(c.task_type)}`,children:c.task_type})]}),c.task_type==="roleplay"&&c.scenario&&e.jsxs("div",{className:"mb-4 p-4 bg-primary/10 border border-primary/20 rounded-xl",children:[e.jsx("p",{className:"text-sm text-primary font-bold mb-2 uppercase tracking-widest",children:"Scenario"}),e.jsx("p",{className:"text-white leading-relaxed",children:c.scenario})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-sm text-secondary-grey mb-2 uppercase tracking-widest",children:"Focus Area"}),e.jsx("p",{className:"text-white font-medium",children:c.focus_area})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("p",{className:"text-sm text-secondary-grey mb-2 uppercase tracking-widest",children:"Instructions"}),e.jsx("p",{className:"text-white text-lg leading-relaxed",children:c.instructions})]}),c.task_type==="roleplay"&&c.dialogue_script&&e.jsxs("div",{className:"mb-6 p-5 bg-surface-dark/50 border border-white/10 rounded-xl",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("span",{className:"material-symbols-outlined text-primary",children:"script"}),e.jsx("p",{className:"text-sm font-bold text-primary uppercase tracking-widest",children:"Dialogue Script"})]}),e.jsx("div",{className:"bg-black/20 p-4 rounded-lg border border-white/5",children:e.jsx("pre",{className:"text-white text-sm leading-relaxed whitespace-pre-wrap font-sans",children:c.dialogue_script})}),c.user_lines&&c.user_lines.length>0&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-white/10",children:[e.jsx("p",{className:"text-xs text-secondary-grey mb-2 uppercase tracking-widest",children:"Your Lines to Practice:"}),e.jsx("ul",{className:"space-y-2",children:c.user_lines.map((t,r)=>e.jsxs("li",{className:"text-sm text-white flex items-start gap-2",children:[e.jsxs("span",{className:"text-primary font-bold",children:[r+1,"."]}),e.jsxs("span",{className:"italic",children:['"',t,'"']})]},r))})]})]}),ne&&e.jsxs("div",{className:"flex items-center gap-2 text-primary mb-4",children:[e.jsx("span",{className:"material-symbols-outlined animate-pulse",children:"mic"}),e.jsx("span",{className:"text-sm font-medium",children:"Listening for your response..."})]}),e.jsx("div",{className:"flex gap-3",children:!ne&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:xe,className:"flex-1 px-4 py-3 bg-primary hover:bg-primary-glow text-white rounded-xl font-bold transition-all",children:"Next Task"}),e.jsx("button",{onClick:Pe,className:"px-4 py-3 bg-surface-dark hover:bg-surface-dark/80 text-secondary-grey rounded-xl font-bold transition-all",children:"Skip"})]})})]}),x&&u==="tasks"&&e.jsxs("div",{className:`bg-surface-card rounded-2xl p-6 border-2 ${x.is_correct?"border-green-500/30 bg-green-500/5":"border-orange-500/30 bg-orange-500/5"}`,children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("span",{className:"text-3xl",children:x.is_correct?"âœ…":"âš ï¸"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-white",children:x.is_correct?"Well Done!":"Keep Practicing"}),e.jsxs("p",{className:"text-sm text-secondary-grey",children:["Score: ",x.score,"/100"]})]})]}),e.jsx("div",{className:"mb-4",children:e.jsx("p",{className:"text-white leading-relaxed",children:x.feedback})}),x.strengths&&x.strengths.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-sm font-bold text-green-400 mb-2",children:"Strengths:"}),e.jsx("ul",{className:"space-y-1",children:x.strengths.map((t,r)=>e.jsxs("li",{className:"text-sm text-white flex items-start gap-2",children:[e.jsx("span",{className:"text-green-400",children:"âœ“"}),e.jsx("span",{children:t})]},r))})]}),x.improvements&&x.improvements.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-sm font-bold text-orange-400 mb-2",children:"Areas to Improve:"}),e.jsx("ul",{className:"space-y-1",children:x.improvements.map((t,r)=>e.jsxs("li",{className:"text-sm text-white flex items-start gap-2",children:[e.jsx("span",{className:"text-orange-400",children:"â†’"}),e.jsx("span",{children:t})]},r))})]}),e.jsxs("div",{className:"flex gap-3 mt-4",children:[e.jsx("button",{onClick:xe,className:"flex-1 px-4 py-3 bg-primary hover:bg-primary-glow text-white rounded-xl font-bold transition-all",children:"Next Task"}),x.should_retry&&e.jsx("button",{onClick:()=>{f(null),C(!0)},className:"px-4 py-3 bg-surface-dark hover:bg-surface-dark/80 text-white rounded-xl font-bold transition-all",children:"Try Again"})]})]}),se.length>0&&e.jsxs("div",{className:"bg-surface-card rounded-2xl p-6 border border-white/5",children:[e.jsxs("h3",{className:"text-lg font-bold text-white mb-4 flex items-center gap-2",children:[e.jsx("span",{className:"material-symbols-outlined text-primary",children:"auto_fix_high"}),"Recent Corrections"]}),e.jsx("div",{className:"space-y-3",children:se.map(t=>e.jsxs("div",{className:`p-4 rounded-xl border ${Ee(t.error_type)}`,children:[e.jsx("div",{className:"flex items-start justify-between mb-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:Le(t.error_type)}),e.jsx("span",{className:"text-xs font-bold uppercase tracking-widest",children:t.error_type})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-secondary-grey",children:"You said:"}),e.jsx("p",{className:"text-sm line-through opacity-70",children:t.original_text})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-secondary-grey",children:"Correct:"}),e.jsx("p",{className:"text-sm font-bold",children:t.corrected_text})]}),t.explanation&&e.jsx("p",{className:"text-xs italic opacity-80",children:t.explanation}),t.phonetic_guidance&&e.jsxs("div",{className:"mt-2 p-2 bg-black/20 rounded",children:[e.jsx("span",{className:"text-xs text-secondary-grey",children:"Pronunciation:"}),e.jsx("p",{className:"text-xs font-mono",children:t.phonetic_guidance})]})]})]},t.id))})]}),e.jsxs("div",{className:"bg-surface-card rounded-2xl p-8 sm:p-12 border border-white/5 shadow-xl relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 right-0 w-80 h-80 bg-primary/10 rounded-full blur-3xl -mr-32 -mt-32"}),e.jsxs("div",{className:"relative z-10 flex flex-col items-center text-center",children:[e.jsx("div",{className:`w-28 h-28 rounded-full flex items-center justify-center mb-8 transition-all duration-700 ${l===d.ACTIVE?"bg-primary shadow-2xl shadow-primary/50 scale-105":"bg-surface-dark border-2 border-primary/20"}`,children:l===d.ACTIVE?e.jsx("div",{className:"flex items-center gap-1.5 h-12",children:[0,1,2,3,4].map(t=>e.jsx("div",{className:"w-1.5 bg-white rounded-full animate-bounce",style:{height:`${20+Math.random()*40}px`,animationDelay:`${t*.1}s`}},t))}):e.jsx("span",{className:"material-symbols-outlined text-5xl text-primary",children:"mic"})}),e.jsx("h2",{className:"text-3xl font-bold text-white mb-3",children:l===d.ACTIVE?H?(he=we.find(t=>t.id===H))==null?void 0:he.title:"Tutoring with Alistair":"Fancy a chat?"}),e.jsx("p",{className:"text-secondary-grey max-w-md mx-auto mb-10 text-lg",children:l===d.ACTIVE?"Alistair is listening. Keep the conversation going!":"Master the accent and culture. Pick a topic or just start talking below."}),z&&e.jsxs("div",{className:"mb-8 p-4 bg-red-500/10 border border-red-500/20 text-red-400 rounded-2xl flex items-center gap-3",children:[e.jsx("span",{className:"material-symbols-outlined",children:"error"}),e.jsx("span",{children:z})]}),e.jsx("button",{onClick:Ae,disabled:l===d.CONNECTING,className:`px-10 py-5 rounded-2xl font-bold text-lg shadow-xl transition-all active:scale-95 ${l===d.ACTIVE?"bg-red-500 hover:bg-red-600 text-white":"bg-primary hover:bg-primary-glow text-white"}`,children:l===d.ACTIVE?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"material-symbols-outlined align-middle mr-2",children:"mic_off"}),"Stop session"]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"material-symbols-outlined align-middle mr-2",children:"mic"}),"Start session"]})})]})]}),($||U)&&e.jsx("div",{className:"bg-surface-card rounded-2xl p-6 border border-white/5",children:e.jsxs("div",{className:"space-y-4 max-h-[300px] overflow-y-auto pr-4",children:[$&&e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-primary/20 flex items-center justify-center text-xs font-bold text-primary flex-shrink-0",children:"YOU"}),e.jsx("p",{className:"text-white text-base italic leading-relaxed break-words",children:$})]}),U&&e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-primary flex items-center justify-center text-xs font-bold text-white flex-shrink-0",children:"AI"}),e.jsx("p",{className:"text-white text-base font-medium leading-relaxed break-words",children:U})]})]})}),l===d.IDLE&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-bold text-primary uppercase tracking-widest mb-6 flex items-center gap-3",children:[e.jsx("span",{className:"material-symbols-outlined",children:"translate"}),"Daily Scenarios"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:we.map(t=>e.jsxs("button",{onClick:()=>K(t),className:"bg-surface-card p-6 rounded-2xl border border-white/5 text-left hover:border-primary/30 hover:shadow-xl hover:-translate-y-1 transition-all group flex flex-col h-full",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-primary/10 flex items-center justify-center text-2xl mb-4 group-hover:bg-primary/20 transition-all",children:t.icon}),e.jsx("h4",{className:"font-bold text-white mb-2 text-lg",children:t.title}),e.jsx("p",{className:"text-sm text-secondary-grey leading-relaxed mb-4 flex-1",children:t.description}),e.jsxs("div",{className:"flex items-center gap-2 text-xs font-bold text-primary",children:["Start Roleplay",e.jsx("span",{className:"material-symbols-outlined text-sm group-hover:translate-x-1 transition-transform",children:"arrow_forward"})]})]},t.id))})]}),(Z||ee.length>0)&&e.jsxs("div",{className:"bg-gradient-to-br from-primary/20 to-primary/10 rounded-2xl p-8 border border-primary/20",children:[e.jsxs("h3",{className:"text-2xl font-bold mb-6 flex items-center gap-4 text-white",children:[e.jsx("span",{className:"material-symbols-outlined text-primary",children:"auto_awesome"}),"Session Summary"]}),Z?e.jsxs("div",{className:"flex flex-col items-center py-12",children:[e.jsx("div",{className:"w-12 h-12 border-4 border-primary/20 border-t-primary rounded-full animate-spin mb-6"}),e.jsx("p",{className:"font-bold text-lg text-white",children:"Analyzing your fluency..."})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:ee.map(t=>e.jsxs("div",{className:"bg-surface-dark/50 backdrop-blur-md p-6 rounded-2xl border border-white/5",children:[e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsx("h4",{className:"font-bold text-white text-lg",children:t.word}),e.jsx("button",{onClick:()=>{j.some(r=>r.word.toLowerCase()===t.word.toLowerCase())||ce(r=>[t,...r])},className:"p-2 bg-primary/20 rounded-xl hover:bg-primary/30 transition-all",children:e.jsx("span",{className:"material-symbols-outlined text-primary text-sm",children:j.some(r=>r.word.toLowerCase()===t.word.toLowerCase())?"check_circle":"add"})})]}),e.jsx("p",{className:"text-sm text-secondary-grey mb-4",children:t.definition}),e.jsx("div",{className:"bg-surface-dark p-3 rounded-xl",children:e.jsxs("p",{className:"text-xs italic text-secondary-grey",children:['"',t.example,'"']})})]},t.id))})]})]}),D==="lexicon"&&e.jsxs("div",{children:[e.jsxs("h2",{className:"text-3xl font-bold text-white mb-8 flex items-center gap-4",children:[e.jsx("span",{className:"material-symbols-outlined text-primary",children:"menu_book"}),"British Lexicon"]}),j.length===0?e.jsxs("div",{className:"bg-surface-card rounded-3xl border-2 border-dashed border-white/10 p-24 text-center",children:[e.jsx("span",{className:"material-symbols-outlined text-6xl text-white/20 mb-8",children:"menu_book"}),e.jsx("h3",{className:"text-2xl font-bold text-white mb-4",children:"Your Lexicon is empty"}),e.jsx("button",{onClick:()=>X("practice"),className:"px-10 py-5 bg-primary text-white rounded-2xl font-bold shadow-lg hover:bg-primary-glow transition-all",children:"Start Practising"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:j.map(t=>e.jsxs("div",{className:"bg-surface-card rounded-2xl p-6 shadow-sm border border-white/5 flex flex-col group relative hover:shadow-xl transition-all",children:[e.jsx("button",{onClick:()=>ce(r=>r.filter(B=>B.id!==t.id)),className:"absolute top-4 right-4 p-2 text-secondary-grey hover:text-red-400 opacity-0 group-hover:opacity-100 transition-all",children:e.jsx("span",{className:"material-symbols-outlined text-sm",children:"delete"})}),e.jsx("span",{className:"px-2 py-1 bg-primary/20 text-primary text-xs font-bold rounded uppercase w-max mb-4",children:"UK English"}),e.jsx("h3",{className:"text-2xl font-bold text-white mb-2",children:t.word}),e.jsx("p",{className:"text-secondary-grey text-sm mb-6 flex-1",children:t.definition}),e.jsx("div",{className:"bg-surface-dark p-4 rounded-xl",children:e.jsxs("p",{className:"text-xs italic text-secondary-grey font-medium",children:['"',t.example,'"']})})]},t.id))})]}),D==="dashboard"&&e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-5",children:[e.jsx("div",{className:"p-4 bg-primary/10 rounded-2xl",children:e.jsx("span",{className:"material-symbols-outlined text-4xl text-primary",children:"dashboard"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold text-white mb-1",children:"Fluency Profile"}),e.jsx("p",{className:"text-secondary-grey font-bold uppercase text-xs tracking-widest",children:"Mastery over time"})]})]}),e.jsxs("div",{className:"flex flex-col items-end",children:[e.jsx("span",{className:"text-xs font-bold text-secondary-grey uppercase mb-1",children:"Current Level"}),e.jsxs("div",{className:"px-6 py-3 bg-primary text-white rounded-2xl font-bold flex items-center gap-3 shadow-xl",children:[e.jsx("span",{className:"material-symbols-outlined text-sm",children:"person"}),b.sessions.length<5?"The Tourist":b.sessions.length<15?"The Commuter":"The Local"]})]})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[{label:"Practice Sessions",value:b.sessions.length,icon:"ðŸŽ¯",color:"bg-primary/10 text-primary"},{label:"Total Minutes",value:b.totalMinutes,icon:"â°",color:"bg-blue-500/10 text-blue-400"},{label:"Streak Days",value:b.streakDays,icon:"ðŸ”¥",color:"bg-orange-500/10 text-orange-400"},{label:"Vocabulary",value:j.length,icon:"ðŸ“š",color:"bg-green-500/10 text-green-400"},{label:"Corrections Received",value:b.correctionsReceived||0,icon:"âœ¨",color:"bg-purple-500/10 text-purple-400"},{label:"Tasks Completed",value:b.tasksCompleted||0,icon:"âœ…",color:"bg-yellow-500/10 text-yellow-400"},{label:"Avg Task Score",value:b.tasksTotalScore?Math.round(b.tasksTotalScore):0,icon:"ðŸ“Š",color:"bg-indigo-500/10 text-indigo-400"}].map((t,r)=>e.jsxs("div",{className:"bg-surface-card p-6 rounded-2xl border border-white/5 flex items-center gap-4",children:[e.jsx("div",{className:`w-12 h-12 ${t.color} rounded-xl flex items-center justify-center text-xl`,children:t.icon}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-bold text-secondary-grey uppercase tracking-widest mb-1",children:t.label}),e.jsx("p",{className:"text-xl font-bold text-white",children:t.value})]})]},r))}),ae.length>0&&e.jsxs("div",{className:"bg-surface-card rounded-2xl p-6 border border-white/5",children:[e.jsxs("h3",{className:"text-xl font-bold text-white mb-6 flex items-center gap-3",children:[e.jsx("span",{className:"material-symbols-outlined text-primary",children:"history"}),"Task History"]}),e.jsx("div",{className:"space-y-4 max-h-[400px] overflow-y-auto",children:ae.slice(0,10).map(t=>e.jsxs("div",{className:"bg-surface-dark/50 p-4 rounded-xl border border-white/5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xl",children:me(t.task_type)}),e.jsx("span",{className:`px-2 py-1 rounded text-xs font-bold ${pe(t.task_type)}`,children:t.task_type})]}),t.evaluation&&e.jsxs("span",{className:`text-sm font-bold ${t.evaluation.score>=80?"text-green-400":t.evaluation.score>=60?"text-yellow-400":"text-red-400"}`,children:[t.evaluation.score,"/100"]})]}),e.jsx("p",{className:"text-sm text-white mb-1",children:t.instructions}),e.jsx("p",{className:"text-xs text-secondary-grey",children:t.focus_area}),t.evaluation&&e.jsx("div",{className:"mt-2 pt-2 border-t border-white/5",children:e.jsx("p",{className:"text-xs text-secondary-grey",children:t.evaluation.feedback})})]},t.id))})]})]})]})}export{tt as default};
