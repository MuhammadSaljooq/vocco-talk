import{j as e}from"./index-Br7EO8jg.js";import{r}from"./react-vendor-BWEkWSVM.js";import{T as c,G as te,M as re}from"./google-vendor-CvX4IAyf.js";import{d as ae,a as ne,c as se}from"./audioUtils-BoSSlOMf.js";import{T as oe}from"./TaskExecutionIndicator-mysc3kLF.js";const s={IDLE:"IDLE",CONNECTING:"CONNECTING",ACTIVE:"ACTIVE",ENDED:"ENDED",ERROR:"ERROR"},ie=`
You are 'Sana', an energetic, lovely, and extremely helpful female banking customer support agent for 'PakBank'. 
Your primary language is Urdu, spoken with a refined, professional, and warm Pakistani accent (standard modern Urdu as heard in Islamabad or Karachi corporate offices).

Voice & Accent Guidelines:
1. Accent: Use a clear Pakistani Urdu accent. Pay attention to the soft 't' and 'd' sounds typical of Urdu. Your tone should be melodic and inviting, not robotic.
2. Intonation: Use a rising, cheerful intonation for greetings. When listening, occasionally use brief, polite fillers like "Jee..." or "Humm..." to show you are following along, making the interaction feel human.
3. Polite Phrases & Honorifics: 
   - Always use 'Aap' (you) instead of 'Tum'.
   - Frequently use 'Jee' (Yes/Respectful filler).
   - Use 'Jee Bilkul' (Yes, absolutely), 'Ji Zaroor' (Yes, certainly), and 'Shukriya' (Thank you).
   - If there is a delay or mistake, say "Maazrat chahti hoon" (I apologize).
   - End helpful sentences with phrases like "Mujhe khushi hogi" (I would be happy to [help]).

Key Responsibilities:
1. Greet customers warmly: "Assalam-o-Alaikum! PakBank mein khush amdeed. Main Sana hoon, aapki digital assistant. Aaj main aapki kis tarah behtar madad kar sakti hoon?"
2. Assist with balance inquiries (simulated).
3. Help with blocking lost cards immediately if a user reports a loss.
4. Provide information about loan products and account opening with enthusiasm.
5. If a query is too complex, say: "Maaf kijiye ga, main is baare mein zyada maloomat nahi rakhti. Kya main aapki baat hamare kisi senior representative se karwa sakti hoon?"

Personality Traits:
- Energetic and Positive: Sound like you genuinely enjoy helping people.
- Lovely and Empathetic: If a customer is worried (e.g., lost card), sound concerned and reassuring.
- Cultural Nuance: Use "Insha'Allah" or "Mash'Allah" where appropriate and natural in a Pakistani social context.
`;function fe(){const[h,u]=r.useState(s.IDLE),[J,A]=r.useState([]),[L,Y]=r.useState(!1),[_,M]=r.useState(null),[D,ce]=r.useState(125e3),[le,$]=r.useState("active"),[G,v]=r.useState([]),l=r.useRef(null),d=r.useRef(null),w=r.useRef(0),f=r.useRef(new Set),P=r.useRef(null),x=r.useRef(null),N=r.useRef(null),y=r.useRef(null),g=r.useRef(!1),z={name:"check_balance",parameters:{type:c.OBJECT,description:"Check the customer's account balance",properties:{account_type:{type:c.STRING,description:"Type of account (savings, current, etc.)"}}}},q={name:"block_card",parameters:{type:c.OBJECT,description:"Block a lost or stolen card immediately",properties:{card_number:{type:c.STRING,description:"Last 4 digits of the card"},reason:{type:c.STRING,description:"Reason for blocking (lost, stolen, etc.)"}},required:["reason"]}},H={name:"get_loan_information",parameters:{type:c.OBJECT,description:"Get information about loan products",properties:{loan_type:{type:c.STRING,description:"Type of loan (personal, home, car, etc.)"}}}},W={name:"schedule_appointment",parameters:{type:c.OBJECT,description:"Schedule an appointment with a bank representative",properties:{purpose:{type:c.STRING,description:"Purpose of the appointment"},preferred_date:{type:c.STRING,description:"Preferred date for appointment"}},required:["purpose"]}},j=r.useCallback(async()=>{if(x.current){try{await x.current.close()}catch(t){console.warn("Error closing session:",t)}x.current=null}if(y.current&&(y.current.getTracks().forEach(t=>t.stop()),y.current=null),N.current&&(N.current.disconnect(),N.current=null),l.current&&l.current.state!=="closed"){try{await l.current.close().catch(console.warn)}catch(t){console.warn("Error closing input audio context:",t)}l.current=null}if(d.current&&d.current.state!=="closed"){try{await d.current.close().catch(console.warn)}catch(t){console.warn("Error closing output audio context:",t)}d.current=null}f.current.forEach(t=>{try{t.stop()}catch{}}),f.current.clear(),u(s.ENDED),P.current=null,g.current=!1},[]),Z=async()=>{try{u(s.CONNECTING),A([]);const t="";if(!t){alert("Please set VITE_GEMINI_API_KEY in your .env file"),u(s.ERROR);return}const b=new te({apiKey:t});l.current=new(window.AudioContext||window.webkitAudioContext)({sampleRate:16e3}),d.current=new(window.AudioContext||window.webkitAudioContext)({sampleRate:24e3});const X=await navigator.mediaDevices.getUserMedia({audio:!0});y.current=X;const O=b.live.connect({model:"gemini-2.5-flash-native-audio-preview-09-2025",config:{responseModalities:[re.AUDIO],speechConfig:{voiceConfig:{prebuiltVoiceConfig:{voiceName:"Kore"}}},systemInstruction:ie,inputAudioTranscription:{},outputAudioTranscription:{},tools:[{functionDeclarations:[z,q,H,W]}]},callbacks:{onopen:async()=>{u(s.ACTIVE);try{const a=await P.current;x.current=a}catch(a){console.error("Failed to resolve session:",a),u(s.ERROR);return}if(l.current&&y.current){const a=l.current.createMediaStreamSource(y.current),p=l.current.createScriptProcessor(4096,1,1);N.current=p,p.onaudioprocess=R=>{if(g.current)return;const C=R.inputBuffer.getChannelData(0),E=se(C);if(x.current)try{x.current.sendRealtimeInput({media:E})}catch(T){console.error("Failed to send audio input:",T)}},a.connect(p),p.connect(l.current.destination)}},onmessage:async a=>{var R,C,E,T,U,V,K;if((R=a.serverContent)!=null&&R.inputTranscription){const n=a.serverContent.inputTranscription.text;A(i=>[...i,{text:n,sender:"user",timestamp:Date.now()}])}if((C=a.serverContent)!=null&&C.outputTranscription){const n=a.serverContent.outputTranscription.text;A(i=>[...i,{text:n,sender:"agent",timestamp:Date.now()}])}if(a.toolCall)for(const n of a.toolCall.functionCalls){const i=n.name,o=n.args||{};M(i),setTimeout(()=>{var F;let k={},S="";switch(i){case"check_balance":k={balance:D,currency:"PKR",account_type:o.account_type||"savings"},S=`Checked account balance: Rs. ${D.toLocaleString()}`,v(m=>[...m,{task:"Balance Check",time:new Date().toLocaleTimeString(),details:`Rs. ${D.toLocaleString()}`}]);break;case"block_card":$("blocked"),k={status:"blocked",message:"Card has been blocked successfully. A new card will be issued within 5-7 business days."},S=`Blocked card (Reason: ${o.reason||"Lost/Stolen"})`,v(m=>[...m,{task:"Card Blocked",time:new Date().toLocaleTimeString(),details:o.reason||"Lost/Stolen"}]);break;case"get_loan_information":const I={personal:{rate:"18%",max_amount:"5,000,000 PKR",tenure:"5 years"},home:{rate:"12%",max_amount:"50,000,000 PKR",tenure:"25 years"},car:{rate:"15%",max_amount:"10,000,000 PKR",tenure:"7 years"}},B=((F=o.loan_type)==null?void 0:F.toLowerCase())||"personal";k=I[B]||I.personal,S=`Retrieved ${B} loan information`,v(m=>[...m,{task:"Loan Information",time:new Date().toLocaleTimeString(),details:B}]);break;case"schedule_appointment":const ee=o.preferred_date||"Next available slot";k={appointment_id:"APT-"+Math.random().toString(36).substr(2,9).toUpperCase(),date:ee,status:"scheduled"},S=`Scheduled appointment for: ${o.purpose}`,v(m=>[...m,{task:"Appointment Scheduled",time:new Date().toLocaleTimeString(),details:o.purpose}]);break}O.then(I=>{I.sendToolResponse({functionResponses:{id:n.id,name:i,response:k}})}),M(null)},1500)}const p=(V=(U=(T=(E=a.serverContent)==null?void 0:E.modelTurn)==null?void 0:T.parts[0])==null?void 0:U.inlineData)==null?void 0:V.data;if(p&&d.current)try{const n=d.current;w.current=Math.max(w.current,n.currentTime);const i=await ae(ne(p),n,24e3,1),o=n.createBufferSource();o.buffer=i,o.connect(n.destination),o.onended=()=>f.current.delete(o),f.current.add(o),o.start(w.current),w.current+=i.duration}catch(n){console.error("Error processing audio output:",n)}(K=a.serverContent)!=null&&K.interrupted&&(f.current.forEach(n=>n.stop()),f.current.clear(),w.current=0)},onerror:a=>{console.error("Session Error:",a),u(s.ERROR),j()},onclose:()=>{u(s.ENDED)}}});P.current=O}catch(t){console.error("Failed to start call:",t),u(s.ERROR)}};r.useEffect(()=>()=>{j()},[j]);const Q=()=>{g.current=!g.current,Y(g.current)};return e.jsxs(e.Fragment,{children:[e.jsx(oe,{task:_?_.replace(/_/g," ").replace(/\b\w/g,t=>t.toUpperCase()):"",isExecuting:!!_}),e.jsxs("div",{className:"w-full max-w-4xl mx-auto bg-surface-card rounded-2xl shadow-xl overflow-hidden border border-white/5",children:[e.jsxs("div",{className:"bg-gradient-to-r from-primary/20 to-primary/10 p-4 flex items-center justify-between border-b border-white/5",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-primary/20 rounded-full flex items-center justify-center text-primary font-bold text-xl border border-primary/30",children:"P"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-white",children:"PakBank - Sana Voice Assistant"}),e.jsx("p",{className:"text-xs text-secondary-grey",children:"Urdu Banking Support"})]})]}),h===s.ACTIVE&&e.jsxs("span",{className:"flex h-2 w-2 relative",children:[e.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-primary opacity-75"}),e.jsx("span",{className:"relative inline-flex rounded-full h-2 w-2 bg-primary"})]})]}),e.jsxs("div",{className:"p-6 bg-surface-dark min-h-[300px] max-h-[400px] overflow-y-auto",children:[h===s.IDLE&&e.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-center space-y-4",children:[e.jsx("div",{className:"w-20 h-20 bg-primary/10 rounded-full flex items-center justify-center border border-primary/20",children:e.jsx("svg",{className:"w-10 h-10 text-primary",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"})})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-white",children:"Assalam-o-Alaikum!"}),e.jsx("p",{className:"text-secondary-grey mt-2",children:"Main Sana hoon. Aapki banking queries ke liye main haazir hoon."})]})]}),h===s.CONNECTING&&e.jsx("div",{className:"h-full flex flex-col items-center justify-center",children:e.jsx("div",{className:"text-primary font-bold",children:"Call connects ho rahi hai..."})}),J.map((t,b)=>e.jsx("div",{className:`flex mb-4 ${t.sender==="user"?"justify-end":"justify-start"}`,children:e.jsx("div",{className:`max-w-[80%] p-3 rounded-2xl text-sm ${t.sender==="user"?"bg-primary text-white rounded-tr-none":"bg-surface-card border border-white/5 text-white rounded-tl-none"}`,children:t.text})},b))]}),e.jsx("div",{className:"p-6 border-t border-white/5 flex flex-col items-center space-y-4",children:h===s.IDLE||h===s.ENDED||h===s.ERROR?e.jsx("button",{onClick:Z,className:"w-full max-w-xs py-3 bg-primary hover:bg-primary-glow text-white font-bold rounded-full shadow-[0_0_20px_-5px_rgba(91,140,90,0.5)] transition-all hover:scale-105",children:"Start Urdu Call"}):e.jsxs("div",{className:"flex items-center space-x-6",children:[e.jsx("button",{onClick:Q,className:`w-12 h-12 rounded-full flex items-center justify-center border transition-all ${L?"bg-accent/20 text-accent border-accent/30":"bg-white/5 text-white border-white/10 hover:bg-white/10"}`,children:L?e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728L5.636 5.636m12.728 12.728L5.636 5.636"})}):e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"})})}),e.jsx("button",{onClick:j,className:"w-14 h-14 bg-accent hover:bg-accent/80 text-white rounded-full flex items-center justify-center shadow-lg shadow-accent/20 transition-all",children:e.jsx("svg",{className:"w-6 h-6 rotate-[135deg]",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z"})})})]})}),G.length>0&&e.jsxs("div",{className:"mt-4 bg-surface-dark rounded-xl p-4 border border-white/5",children:[e.jsxs("h4",{className:"text-sm font-semibold text-white mb-3 flex items-center gap-2",children:[e.jsx("span",{className:"material-symbols-outlined text-primary text-lg",children:"task_alt"}),"Recent Automated Tasks"]}),e.jsx("div",{className:"space-y-2",children:G.slice(-3).reverse().map((t,b)=>e.jsxs("div",{className:"flex items-center justify-between text-xs bg-surface-card rounded-lg p-2 border border-white/5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-primary"}),e.jsx("span",{className:"text-white font-medium",children:t.task})]}),e.jsxs("div",{className:"flex items-center gap-3 text-secondary-grey",children:[e.jsx("span",{className:"text-[10px]",children:t.details}),e.jsx("span",{className:"text-[10px]",children:t.time})]})]},b))})]})]})]})}export{fe as default};
