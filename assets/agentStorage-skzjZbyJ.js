import{g as c}from"./index-Br7EO8jg.js";const p="vocco_talk_prompt_versions";function v(t,r,n={}){try{const e=localStorage.getItem(p),s=e?JSON.parse(e):{};s[t]||(s[t]=[]);const o={version:s[t].length+1,prompt:r,createdAt:new Date().toISOString(),metadata:{reason:n.reason||"Manual update",notes:n.notes||"",changedBy:n.changedBy||"user",...n},isActive:!0};return s[t].forEach(i=>{i.isActive=!1}),s[t].push(o),s[t].length>10&&(s[t]=s[t].slice(-10)),localStorage.setItem(p,JSON.stringify(s)),o}catch(e){throw console.error("Error saving prompt version:",e),e}}const l="vocco_talk_agents";function f(){try{const t=c();if(!t)return[];const r=localStorage.getItem(l);return(r?JSON.parse(r):[]).filter(e=>e.userId===t.id)}catch(t){return console.error("Error loading agents:",t),[]}}function S(t){try{const r=c();if(!r)throw new Error("User must be logged in to save agents");const n=f(),e=g(),s=!t.id,o={...t,id:t.id||`agent_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,userId:r.id,createdAt:t.createdAt||new Date().toISOString(),updatedAt:new Date().toISOString(),conversations:t.conversations||0,apiCalls:t.apiCalls||0,voiceMinutes:t.voiceMinutes||0,promptVersion:t.promptVersion||1};if(o.systemPrompt){const a=e.findIndex(u=>u.id===o.id),d=a>=0?e[a]:null;if(s||!d||d.systemPrompt!==o.systemPrompt)try{v(o.id,o.systemPrompt,{reason:s?"Initial creation":"Prompt updated",changedBy:r.id}),o.promptVersion=(o.promptVersion||0)+1}catch(u){console.warn("Failed to save prompt version:",u)}}const i=e.findIndex(a=>a.id===o.id);return i>=0?e[i]=o:e.push(o),localStorage.setItem(l,JSON.stringify(e)),o}catch(r){throw console.error("Error saving agent:",r),r}}function g(){try{const t=localStorage.getItem(l);return t?JSON.parse(t):[]}catch(t){return console.error("Error loading agents:",t),[]}}function m(t){return g().find(n=>n.id===t)||null}function h(t){try{const r=c();if(!r)return!1;const n=g(),e=n.find(o=>o.id===t);if(!e||e.userId!==r.id)return!1;const s=n.filter(o=>o.id!==t);return localStorage.setItem(l,JSON.stringify(s)),!0}catch(r){return console.error("Error deleting agent:",r),!1}}function y(t,r){try{const n=c();if(!n)return!1;const e=m(t);return!e||e.userId!==n.id?!1:(e.conversations=(e.conversations||0)+(r.conversations||0),e.apiCalls=(e.apiCalls||0)+(r.apiCalls||0),e.voiceMinutes=(e.voiceMinutes||0)+(r.voiceMinutes||0),e.updatedAt=new Date().toISOString(),S(e),!0)}catch(n){return console.error("Error updating agent stats:",n),!1}}function I(){const t=f();return{totalAgents:t.length,totalConversations:t.reduce((r,n)=>r+(n.conversations||0),0),totalApiCalls:t.reduce((r,n)=>r+(n.apiCalls||0),0),totalVoiceMinutes:t.reduce((r,n)=>r+(n.voiceMinutes||0),0)}}export{I as a,h as d,f as g,S as s,y as u};
